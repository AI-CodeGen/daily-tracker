const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Config-Ci0jRwXq.js","assets/react-vendor-b1xrIhnT.js","assets/vendor-g6wOUL2o.js","assets/chart-Dt6o3ARI.js","assets/Alerts-bFziTfmH.js"])))=>i.map(i=>d[i]);
import{r as u,j as e,R as g,b as N}from"./react-vendor-b1xrIhnT.js";import{a9 as S}from"./vendor-g6wOUL2o.js";import{R as E,A as C,a as L}from"./chart-Dt6o3ARI.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))m(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&m(r)}).observe(document,{childList:!0,subtree:!0});function o(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function m(s){if(s.ep)return;s.ep=!0;const n=o(s);fetch(s.href,n)}})();const A="modulepreload",P=function(t){return"/"+t},y={},b=function(a,o,m){let s=Promise.resolve();if(o&&o.length>0){document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),l=(r==null?void 0:r.nonce)||(r==null?void 0:r.getAttribute("nonce"));s=Promise.allSettled(o.map(d=>{if(d=P(d),d in y)return;y[d]=!0;const i=d.endsWith(".css"),p=i?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${p}`))return;const c=document.createElement("link");if(c.rel=i?"stylesheet":A,i||(c.as="script"),c.crossOrigin="",c.href=d,l&&c.setAttribute("nonce",l),document.head.appendChild(c),i)return new Promise((h,x)=>{c.addEventListener("load",h),c.addEventListener("error",()=>x(new Error(`Unable to preload CSS for ${d}`)))})}))}function n(r){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=r,window.dispatchEvent(l),!l.defaultPrevented)throw r}return s.then(r=>{for(const l of r||[])l.status==="rejected"&&n(l.reason);return a().catch(n)})},f=S.create({baseURL:"/api"});async function M(t={}){const{data:a}=await f.get("/assets",{params:t});return a}async function Q(t){const{data:a}=await f.get("/assets",{params:{symbolExact:t}});return a}async function V(t){const{data:a}=await f.post("/assets/batch",t,{headers:{"Content-Type":"text/plain"}});return a}async function J(t){const{data:a}=await f.post("/assets",t);return a}async function T(t,a){const{data:o}=await f.put(`/assets/${t}`,a);return o}async function W(t){await f.delete(`/assets/${t}`)}async function R(){const{data:t}=await f.get("/quotes/current");return t}async function k(t,a=50){const{data:o}=await f.get(`/quotes/${t}/history`,{params:{limit:a}});return o}async function q(t={}){const{data:a}=await f.get("/alerts/history",{params:t});return a}async function I(){const{data:t}=await f.post("/admin/fetch-now");return t}const _=({quote:t})=>{var c;const[a,o]=u.useState([]),[m,s]=u.useState(!1),[n,r]=u.useState(""),[l,d]=u.useState("");u.useEffect(()=>{let h=!0;return k(t.assetId,10).then(x=>{h&&o(x)}),()=>{h=!1}},[t.assetId]);const i=(t.changePercent||0)>=0?"text-emerald-400":"text-rose-400",p=async()=>{await T(t.assetId,{upperThreshold:n?Number(n):void 0,lowerThreshold:l?Number(l):void 0}),s(!1)};return e.jsxs("div",{className:"p-4 bg-gray-900 rounded shadow flex flex-col gap-2 relative",children:[e.jsxs("div",{className:"flex justify-between items-baseline",children:[e.jsx("h3",{className:"font-semibold",children:t.name}),e.jsxs("span",{className:`text-sm ${i}`,children:[(c=t.changePercent)==null?void 0:c.toFixed(2),"%"]})]}),e.jsx("div",{className:"text-2xl font-bold",children:t.price}),e.jsx("div",{className:"h-14",children:e.jsx(E,{width:"100%",height:"100%",children:e.jsx(C,{data:a,children:e.jsx(L,{type:"monotone",dataKey:"price",stroke:"#6366f1",fill:"#6366f1",fillOpacity:.2})})})}),!m&&e.jsx("button",{onClick:()=>{r(""),d(""),s(!0)},className:"self-end text-xs text-indigo-400 hover:underline",children:"Edit thresholds"}),m&&e.jsxs("div",{className:"flex flex-col gap-2 text-xs bg-gray-800/70 p-2 rounded",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{placeholder:"Upper",type:"number",step:"any",value:n,onChange:h=>r(h.target.value),className:"bg-gray-700 px-1 rounded w-24"}),e.jsx("input",{placeholder:"Lower",type:"number",step:"any",value:l,onChange:h=>d(h.target.value),className:"bg-gray-700 px-1 rounded w-24"})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{onClick:()=>s(!1),className:"px-2 py-1 bg-gray-700 rounded",children:"Cancel"}),e.jsx("button",{onClick:p,className:"px-2 py-1 bg-indigo-600 rounded",children:"Save"})]})]}),e.jsxs("div",{className:"text-xs opacity-60",children:["Updated ",new Date(t.takenAt).toLocaleTimeString()]})]})},O=()=>{const[t,a]=u.useState([]),[o,m]=u.useState(!0),[s,n]=u.useState([]),[r,l]=u.useState(!1);async function d(){m(!0);try{const i=await R();a(i)}finally{m(!1)}}return u.useEffect(()=>{d();const i=setInterval(d,30*60*1e3);let p=0,c=null;const h=()=>{c=new EventSource("/api/stream/alerts"),c.addEventListener("thresholdAlert",x=>{p=0;try{const j=JSON.parse(x.data);n(w=>[j,...w].slice(0,5))}catch{}}),c.onerror=()=>{c==null||c.close();const x=Math.min(3e4,1e3*2**p+Math.random()*300);p+=1,setTimeout(h,x)}};return h(),()=>{clearInterval(i),c==null||c.close()}},[]),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-2",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Live Dashboard"}),e.jsx("button",{disabled:r,onClick:async()=>{try{l(!0),await I(),await d()}catch{}finally{l(!1)}},className:"text-xs bg-indigo-600 hover:bg-indigo-500 disabled:opacity-50 px-3 py-1 rounded",children:r?"Refreshing...":"Refresh Now"})]}),s.length>0&&e.jsx("div",{className:"space-y-1",children:s.map(i=>e.jsxs("div",{className:"text-xs bg-gray-800 border-l-4 border-indigo-500 px-2 py-1 rounded",children:[e.jsx("span",{className:"font-semibold",children:i.symbol})," breached ",i.boundary," (",i.threshold,") at ",i.price," Â· ",new Date(i.time).toLocaleTimeString()]},i.time+i.assetId))}),o&&e.jsx("div",{className:"text-sm opacity-60",children:"Loading..."}),e.jsx("div",{className:"grid gap-4 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4",children:t.map(i=>e.jsx(_,{quote:i},i.assetId))})]})},D=g.lazy(()=>b(()=>import("./Config-Ci0jRwXq.js"),__vite__mapDeps([0,1,2,3]))),$=g.lazy(()=>b(()=>import("./Alerts-bFziTfmH.js"),__vite__mapDeps([4,1,2,3]))),U=[{id:"dashboard",label:"Dashboard"},{id:"config",label:"Configuration"},{id:"alerts",label:"Alerts"}],z=()=>{const[t,a]=u.useState("dashboard");return e.jsxs("div",{className:"max-w-7xl mx-auto p-6 space-y-6",children:[e.jsxs("header",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold tracking-wide",children:"Daily Tracker"}),e.jsx("nav",{className:"flex gap-3",children:U.map(o=>e.jsx("button",{onClick:()=>a(o.id),className:`px-3 py-1 rounded text-sm ${t===o.id?"bg-indigo-600":"bg-gray-800 hover:bg-gray-700"}`,children:o.label},o.id))})]}),e.jsxs("main",{children:[t==="dashboard"&&e.jsx(O,{}),t==="config"&&e.jsx(u.Suspense,{fallback:e.jsx("div",{className:"text-sm opacity-60",children:"Loading config..."}),children:e.jsx(D,{})}),t==="alerts"&&e.jsx(u.Suspense,{fallback:e.jsx("div",{className:"text-sm opacity-60",children:"Loading alerts..."}),children:e.jsx($,{})})]})]})},v=u.createContext(void 0),G=()=>{const t=u.useContext(v);if(!t)throw new Error("useToast must be used within ToastProvider");return t},F=({children:t})=>{const[a,o]=u.useState([]),m=u.useCallback((s,n="info")=>{const r=Date.now()+Math.random();o(l=>[...l,{id:r,message:s,type:n}]),setTimeout(()=>o(l=>l.filter(d=>d.id!==r)),4e3)},[]);return e.jsxs(v.Provider,{value:{push:m},children:[t,e.jsx("div",{className:"fixed bottom-4 right-4 space-y-2 z-50 w-72",children:a.map(s=>e.jsx("div",{className:"text-sm px-3 py-2 rounded shadow border "+(s.type==="error"?"bg-rose-600/90 border-rose-400":s.type==="success"?"bg-emerald-600/90 border-emerald-400":"bg-gray-700/90 border-gray-500"),children:s.message},s.id))})]})};N.createRoot(document.getElementById("root")).render(e.jsx(g.StrictMode,{children:e.jsx(F,{children:e.jsx(z,{})})}));export{J as a,V as b,Q as c,T as d,W as e,q as f,M as g,G as u};
