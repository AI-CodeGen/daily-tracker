import{r,j as e}from"./react-vendor-b1xrIhnT.js";import{c as A,u as E,a as _,b as $,d as C,e as q,g as L}from"./index-DE5sUipX.js";import"./vendor-g6wOUL2o.js";import"./chart-Dt6o3ARI.js";const z=({onCreate:x})=>{const[a,n]=r.useState({name:"",symbol:"",providerSymbol:""}),[m,d]=r.useState(!1),[c,u]=r.useState(null),y=async l=>{l.preventDefault(),d(!0);try{const t={name:a.name,symbol:a.symbol,providerSymbol:a.providerSymbol};a.upperThreshold&&(t.upperThreshold=Number(a.upperThreshold)),a.lowerThreshold&&(t.lowerThreshold=Number(a.lowerThreshold)),await x(t),n({name:"",symbol:"",providerSymbol:""})}finally{d(!1)}};return e.jsxs("form",{onSubmit:y,className:"flex gap-2 flex-wrap items-end",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs",children:"Name"}),e.jsx("input",{className:"bg-gray-800 px-2 py-1 rounded",value:a.name,onChange:l=>n(t=>({...t,name:l.target.value})),required:!0})]}),e.jsxs("div",{className:"flex flex-col min-w-40",children:[e.jsx("label",{className:"text-xs",children:"Symbol"}),e.jsx("input",{className:`bg-gray-800 px-2 py-1 rounded ${c?"ring-1 ring-rose-500":""}`,value:a.symbol,onChange:l=>{n(t=>({...t,symbol:l.target.value.toUpperCase()})),u(null)},onBlur:async()=>{if(a.symbol)try{(await A(a.symbol)).exists?u("Symbol already exists"):u(null)}catch{}},required:!0}),c&&e.jsx("span",{className:"text-rose-400 text-[10px] mt-0.5",children:c})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs",children:"Provider Symbol"}),e.jsx("input",{className:"bg-gray-800 px-2 py-1 rounded",value:a.providerSymbol,onChange:l=>n(t=>({...t,providerSymbol:l.target.value})),required:!0})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs",children:"Upper"}),e.jsx("input",{type:"number",step:"any",className:"bg-gray-800 px-2 py-1 rounded w-28",value:a.upperThreshold||"",onChange:l=>n(t=>({...t,upperThreshold:l.target.value}))})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs",children:"Lower"}),e.jsx("input",{type:"number",step:"any",className:"bg-gray-800 px-2 py-1 rounded w-28",value:a.lowerThreshold||"",onChange:l=>n(t=>({...t,lowerThreshold:l.target.value}))})]}),e.jsx("button",{disabled:m||!!c,className:"bg-indigo-600 hover:bg-indigo-500 px-3 py-2 rounded text-sm disabled:opacity-50",children:"Add"})]})},M=()=>{const[x,a]=r.useState([]),[n,m]=r.useState(!0),[d,c]=r.useState(1),[u,y]=r.useState(10),[l,t]=r.useState(1),[P,j]=r.useState(0),[g,D]=r.useState("createdAt"),[b,k]=r.useState("asc"),[v,B]=r.useState(""),p=E(),[f,N]=r.useState(""),[w,S]=r.useState(null);async function h(s=!1){m(!0);try{const i=await L({page:s?1:d,pageSize:u,sortBy:g,sortDir:b,q:v||void 0});Array.isArray(i)?(a(i),t(1),j(i.length)):(a(i.data),t(i.totalPages),j(i.total)),s&&c(1)}catch{p.push("Failed to load assets","error")}finally{m(!1)}}return r.useEffect(()=>{h()},[d,g,b,u]),r.useEffect(()=>{const s=setTimeout(()=>{h(!0)},400);return()=>clearTimeout(s)},[v]),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Configuration"}),e.jsx(z,{onCreate:async s=>{const o=s.symbol||"";if((await A(o)).exists)throw S(`Symbol ${o} already exists`),p.push(`Duplicate symbol: ${o}`,"error"),new Error("Duplicate");S(null);const T=await _(s);return p.push(`Added ${T.symbol}`,"success"),h(!0),T}}),w&&e.jsx("div",{className:"text-xs text-rose-400",children:w}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-end text-xs",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"uppercase tracking-wide",children:"Sort By"}),e.jsxs("select",{value:g,onChange:s=>D(s.target.value),className:"bg-gray-800 px-2 py-1 rounded",children:[e.jsx("option",{value:"createdAt",children:"Created"}),e.jsx("option",{value:"name",children:"Name"}),e.jsx("option",{value:"symbol",children:"Symbol"})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"uppercase tracking-wide",children:"Direction"}),e.jsxs("select",{value:b,onChange:s=>k(s.target.value),className:"bg-gray-800 px-2 py-1 rounded",children:[e.jsx("option",{value:"asc",children:"Asc"}),e.jsx("option",{value:"desc",children:"Desc"})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"uppercase tracking-wide",children:"Search"}),e.jsx("input",{value:v,onChange:s=>B(s.target.value),placeholder:"name/symbol",className:"bg-gray-800 px-2 py-1 rounded w-40"})]}),e.jsxs("div",{className:"flex flex-col w-64",children:[e.jsx("label",{className:"uppercase tracking-wide",children:"Batch CSV"}),e.jsx("textarea",{value:f,onChange:s=>N(s.target.value),rows:3,placeholder:"name,symbol,providerSymbol,upperThreshold,lowerThreshold",className:"bg-gray-800 px-2 py-1 rounded resize-y"})]}),e.jsx("button",{onClick:async()=>{if(f.trim())try{const{imported:s}=await $(f.trim());p.push(`Imported ${s} assets`,"success"),N(""),h(!0)}catch{p.push("Import failed","error")}},className:"bg-indigo-600 px-3 py-2 rounded",children:"Upload"})]}),n&&e.jsx("div",{className:"text-sm opacity-60",children:"Loading..."}),e.jsxs("div",{className:"space-y-2",children:[x.map(s=>e.jsxs("div",{className:"bg-gray-900 rounded p-3 flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-semibold tracking-wide",children:[s.name," ",e.jsxs("span",{className:"text-xs opacity-60",children:["(",s.symbol,")"]})]}),e.jsxs("div",{className:"text-xs opacity-60",children:["Provider: ",s.providerSymbol]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx("input",{type:"number",step:"any",defaultValue:s.upperThreshold??"",placeholder:"Upper",className:"bg-gray-800 w-24 px-1 py-1 rounded",onBlur:async o=>{await C(s._id,{upperThreshold:o.target.value?Number(o.target.value):void 0})}}),e.jsx("input",{type:"number",step:"any",defaultValue:s.lowerThreshold??"",placeholder:"Lower",className:"bg-gray-800 w-24 px-1 py-1 rounded",onBlur:async o=>{await C(s._id,{lowerThreshold:o.target.value?Number(o.target.value):void 0})}}),e.jsx("button",{onClick:async()=>{await q(s._id),a(o=>o.filter(i=>i._id!==s._id)),p.push(`Deleted ${s.symbol}`,"info")},className:"text-rose-400 hover:underline",children:"Delete"})]})]},s._id)),!n&&x.length===0&&e.jsx("div",{className:"text-sm opacity-60",children:"No assets configured yet."})]}),e.jsxs("div",{className:"flex items-center flex-wrap gap-3 text-xs pt-2",children:[e.jsxs("span",{className:"bg-gray-800 px-2 py-1 rounded",children:["Total: ",P]}),e.jsx("button",{disabled:d<=1,onClick:()=>c(s=>Math.max(1,s-1)),className:"px-2 py-1 bg-gray-800 rounded disabled:opacity-40",children:"Prev"}),e.jsxs("span",{children:["Page ",d," / ",l]}),e.jsx("button",{disabled:d>=l,onClick:()=>c(s=>Math.min(l,s+1)),className:"px-2 py-1 bg-gray-800 rounded disabled:opacity-40",children:"Next"}),e.jsxs("label",{className:"flex items-center gap-1",children:["Page Size",e.jsx("select",{value:u,onChange:s=>{y(Number(s.target.value)),c(1)},className:"bg-gray-800 px-2 py-1 rounded",children:[5,10,20,50].map(s=>e.jsx("option",{value:s,children:s},s))})]})]})]})};export{M as ConfigPage,M as default};
